<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ ‚Äî Free Fire</title>
<style>
body {
    margin:0;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:url("backgroundphoto2.jpg") no-repeat center/cover;
    font-family:Arial, sans-serif;
    color:white;
}
.container{
    text-align:center;
    background:rgba(0,0,0,0.85);
    padding:30px;
    border-radius:20px;
    box-shadow:0 0 30px rgba(0,0,0,0.7);
    max-width:400px;
    width:100%;
}
h2{
    margin-bottom:20px;
    color:#FFD700;
    text-shadow:0 0 10px #FFD700;
}
.warning{
    background:#ff0000;
    padding:15px;
    border-radius:12px;
    margin-bottom:20px;
    font-weight:bold;
    animation: blink 1s infinite;
}
@keyframes blink {
    0% { box-shadow:0 0 5px red; opacity:1; }
    50% { box-shadow:0 0 25px red; opacity:0.6; }
    100% { box-shadow:0 0 5px red; opacity:1; }
}
img.qr{
    width:200px;
    margin-bottom:20px;
    border-radius:15px;
}
button{
    padding:12px 40px;
    font-size:16px;
    border:none;
    border-radius:25px;
    cursor:pointer;
    margin:10px;
    font-weight:bold;
    transition:0.3s;
}
button.pay{
    background:linear-gradient(45deg,#ffcc00,#ff5500);
    color:black;
}
button.pay:disabled{
    background:gray;
    cursor:not-allowed;
}
button.pay.active {
    box-shadow: 0 0 20px #ffcc00, 0 0 40px #ff5500;
    animation: glow 1s infinite alternate;
}
@keyframes glow {
    from { box-shadow:0 0 10px #ffcc00,0 0 20px #ff5500; }
    to { box-shadow:0 0 25px #ffcc00,0 0 50px #ff5500; }
}
button.back{
    background:linear-gradient(45deg,#00BFFF,#007BFF);
    color:white;
}
button.historyBtn{
    background: linear-gradient(45deg,#FF69B4,#FF1493);
    color:white;
}
.loader {
    border:6px solid rgba(255,255,255,0.2);
    border-top:6px solid #FFD700;
    border-radius:50%;
    width:50px;
    height:50px;
    margin:20px auto;
    animation:spin 1s linear infinite;
    display:none;
}
@keyframes spin {
    from {transform:rotate(0deg);}
    to {transform:rotate(360deg);}
}
.status-text {
    margin-top:10px;
    font-size:16px;
    color:#FFD700;
    display:none;
}
/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
#historyModal{
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    color:white;
    overflow:auto;
    padding:50px;
}
#historyModal h2{
    margin-bottom:20px;
}
#historyModal button{
    margin-top:20px;
    padding:10px 20px;
}
</style>
</head>
<body>

<div class="container">
    <h2>üí≥ –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h2>

    <div class="warning">
        ‚ùó –í–ê–ñ–ù–û!<br>
        –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ <u>ID –∏–≥—Ä–æ–∫–∞</u> –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ.<br>
        ‚ùå –ë–µ–∑ ID –∑–∞–∫–∞–∑ –ù–ï –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–¢–°–Ø
    </div>

    <img src="QRkode.jpg" alt="QR-–∫–æ–¥" class="qr">

    <button class="historyBtn" id="historyBtn">üìú –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π</button>

    <p>–û–ø–ª–∞—Ç–∏—Ç–µ –∑–∞–∫–∞–∑ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–∏–∂–µ</p>

    <label>
        <input type="checkbox" id="agreeCheck"> –Ø –æ–ø–ª–∞—Ç–∏–ª –∏ —É–∫–∞–∑–∞–ª —Å–≤–æ–π ID
    </label>

    <br><br>

    <button class="pay" id="payBtn" disabled>–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
    <button class="back" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>

    <div class="loader" id="loader"></div>
    <div class="status-text" id="statusText">‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏...</div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ -->
<div id="historyModal">
    <h2>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π</h2>
    <div id="historyContent"></div>
    <button onclick="closeHistory()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
// –ê–ö–¢–ò–í–ê–¶–ò–Ø –ö–ù–û–ü–ö–ò
const agreeCheck = document.getElementById("agreeCheck");
const payBtn = document.getElementById("payBtn");

agreeCheck.addEventListener("change", function(){
    payBtn.disabled = !this.checked;
    if(this.checked) payBtn.classList.add("active");
    else payBtn.classList.remove("active");
});

// –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò –û–¢–ö–†–´–¢–ò–ï –ò–°–¢–û–†–ò–ò
function addPaymentHistory(username, item, amount, date){
    let history = JSON.parse(localStorage.getItem('paymentHistory') || '[]');
    history.push({username, item, amount, date});
    localStorage.setItem('paymentHistory', JSON.stringify(history));
}

document.getElementById('historyBtn').addEventListener('click', function(){
    const username = localStorage.getItem('username');
    const history = JSON.parse(localStorage.getItem('paymentHistory') || '[]')
                        .filter(entry => entry.username === username);

    const contentDiv = document.getElementById('historyContent');
    if(history.length === 0){
        contentDiv.innerHTML = "<p>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>";
    } else {
        contentDiv.innerHTML = history.map(entry =>
            `<p>${entry.date} ‚Äî ${entry.item} ‚Äî ${entry.amount} —Å–æ–º</p>`
        ).join('');
    }

    document.getElementById('historyModal').style.display = 'block';
});

function closeHistory(){
    document.getElementById('historyModal').style.display = 'none';
}

// –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê
payBtn.addEventListener('click', sendOrder);

function sendOrder(){
    const playerID = localStorage.getItem("playerID");
    const selectedItem = localStorage.getItem("selectedItem");
    const username = localStorage.getItem("username");
    const email = localStorage.getItem("email");

    if(!playerID || !selectedItem || !username || !email){
        alert("‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∏ –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.");
        return;
    }

    const loader = document.getElementById("loader");
    const statusText = document.getElementById("statusText");

    loader.style.display = "block";
    statusText.style.display = "block";
    payBtn.disabled = true;

    // üî¥ –í—Å—Ç–∞–≤—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω –∏ ID —á–∞—Ç–∞
    const TOKEN = "8277453712:AAHz4g1w9MDHVn2Nvx-G4VqWFWfH99nMWfc";
    const CHAT_ID = "426389082";

    const orderId = Date.now();

    const message = 
`üÜï –ù–û–í–´–ô –ó–ê–ö–ê–ó
üÜî –ó–∞–∫–∞–∑: #${orderId}

üë§ –ò–º—è: ${username}
üìß Email: ${email}
üéÆ ID –∏–≥—Ä–æ–∫–∞: ${playerID}

üíé –¢–æ–≤–∞—Ä: ${selectedItem}
üí≥ –û–ø–ª–∞—Ç–∞: QR

–ù–∞–∂–º–∏—Ç–µ ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–ª–∏ ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å`;

    fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
            chat_id: CHAT_ID,
            text: message,
            reply_markup: {
                inline_keyboard: [
                    [{text:"‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", callback_data:"approve_"+orderId},
                     {text:"‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å", callback_data:"reject_"+orderId}]
                ]
            }
        })
    })
    .then(()=> {
        statusText.innerText = "‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.";
        loader.style.display = "none";

        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
        const date = new Date().toLocaleString();
        const amount = 95; // –º–æ–∂–Ω–æ –±—Ä–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
        addPaymentHistory(username, selectedItem, amount, date);

    })
    .catch(()=> {
        statusText.innerText = "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
        loader.style.display = "none";
        payBtn.disabled = false;
    });
}

function goBack(){
    window.location.href = "shop.html";
}
</script>
</body>
</html>
